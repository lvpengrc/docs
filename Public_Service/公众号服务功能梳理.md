# 公众号服务

## 概述


融云公众服务包括：应用公众服务（MC）和公众服务平台（MP），它为应用开发者和公众账号运营者提供连接服务。

公众服务平台： 通过平台创建的公众号，面向所有开发者。公众帐号持有者通过平台有机会向所有集成融云 SDK 的 App 提供服务。任何开发者都可以通过开发者后台的公众号市场申请添加公众号到自已的应用中。

应用公众服务： 通过开发者后台创建的应用内私有的公众服务号，为 App 开发者提供 App 内建公众服务能力。其他应用无法使用。

公众号服务为免费的基础功能。

## 公众服务号

### 创建及使用流程

** 1、注册公众服务平台 **

开发者注册公众服务平台，同时创建公众号，需要融云客服人员 Admin 后台审核通过后才能使用。步骤如下：

1. 帐号信息输入，邮箱、密码。
2. 注册邮箱激活。
3. 认证信息输入：身份证姓名、身份证号码、证件照、手机号
4. 公众号信息输入 ：公众号LOGO、昵称、公众号、服务类型、功能描述。
5. 等待客服人员在 Admin 审核，1 个工作日内完成审核。

开发者在提交完认证及公众号信息后，会给 Ticket@rongcloud.cn 发送审批提醒邮件。（目前客服人员没有用到这个邮箱）

平台地址：http://public.rongcloud.cn/login


### 公众号管理平台功能

#### 设置功能

公众号基本信息：LOGO、昵称、服务类型、功能描述

公众号接入模式包括：申请模式、私有模式

* 申请模式：应用开发者可通过开发者管理平台的公众号市场搜索到此公众号，并申请添加到应用，公众号在管理平台审核通后即可与应用关联。

* 私有模式：公众号不会被应用开发者在公众号市场中搜索到，只能通过私有模式下提供的“公众号识别码”与应用进行关联。私有模式下公众号也可以与多个应用关联。

> 公众号是与应用进行关联，成功后开发、生产环境下的应用都可以查询到公众号。


#### 消息

** 消息推送 **

* 每天可以给所有关注公众号的用户发送一条消息，消息类型包括文本、图片、图文、语音。公众号主动推送的消息没有 Push 功能。

* 图片、图文、语音消息内容，可在公众号素材库中选取。

* 支持看推送历史记录。

* 消息推送流程：

	1. 公众平台推送消息到融云 Server
	2. 融云 Server 将消息下发到融云 SDK
	3. 用户在终端，会话中查看消息内容，如推送消息为图文消息内容时，点击消息在页面中显示图文详细内容（内容从公众服务平台读取）。


** 自动回复 **

* 关注公众号后欢迎语回复内容设置，支持文本、图片、图文、语音消息，发送给用户的图文消息没有 Push。

* 关键词自动回复设置，根据设置的关键词回复对应内容，实现快速自动回复，支持文本、图片、图文、语音消息。功能默认为关闭状态。

** 用户回复 **

* 显示所有关联公众号的应用中，用户给公众号发送的消息列表。公众号可以对每条消息进行回复，回复的消息支持 Push 提醒。支持回复文本、图片消息。

** 消息素材管理 **

* 对运营公众号所需要的素材内容进行管理，素材类型包括图片、语音、缩略图。公众号推送消息时，可选择素材库中内容进行发送。

	1. 图片（image）: 2 M，支持 JPG、PNG 格式。
	2. 缩略图(thumb) : 20 K，支持JPG、PNG格式。
	3. 语音（voice）：60 k，播放长度不超过 60s，目前支持 AMR 格式。


* 素材删除后，之前使用该素材发送的消息仍然可以正常显示，消息不进行删除。

#### 自定义菜单

* 公众号中通过菜单引导用户快速查看相关内容，最多支持两级菜单显示，一级最多创建 3 个菜单，每个一级菜单下可创建 5 个二级菜单。默认为关闭状态。

* 菜单支持发送消息、跳转页面两种事件设置。

* 添加、修改菜单内容后，用户需要重新登录新的菜单设置才能生效。


#### 关联应用管理

* 管理所有关联到当前公众号的所有应用，包括已关联、已终止关联、提交申请需要关联的应用。

* 应用开发者在管理平台的公众号市场中申请添加公众号后，公众号所有者在此对提交的添加请求进行审核。

#### 粉丝列表

* 查看所有关联当前公众号的应用中，关注公众号的用户信息。包知：粉丝名称、头像、来源应用名

#### 数据统计

** 粉丝统计 **

* 统计数据包括：新增关注、取消关注、累计关注公众号人数。

* 支持按关注用户所使用的应用来源统计粉丝数据。


** 图文阅读统计 **

* 支持查看推送的图文消息的阅读数及原文链接的点击次数。

** 用户回复统计 **

* 对回复给用户消息的数据统计，包括：回复消息人数、回复消息次数、人均回复次数

### 开发者模式

* 如开发者想自已来进行关注用户及发送、回复的消息管理，可通过开启开发者模式实现。

* 开发者需要设置 URL 地址用来接收用户关注、取消关注的事件，及用户发送给公众号的消息。

* 公众号开发者可通过提供的 API 接口发送消息、进行素材管理。文档地址：http://www.rongcloud.cn/docs/public_service.html#public_service


## 应用公众服务


### 创建及使用流程

* 应用开发者在 `开发者平台 -> 公众服务 -> 应用公众服务` 中创建应用公众服务号，目前最多可创建 10 个。


### 功能说明

* 融云应用公众号基本信息包括：公众号 Id、昵称、LOGO。其中公众号 Id 创建后不能更改，当前应用下公众号 Id 不能重复。

* 应用公众服务不提供粉丝用户、消息素材及数据统计的管理平台。只能通过 API 接口发送消息、管理素材。

* 提供公众服务消息路由功能，如开发者需要管理粉丝、数据统计，可通过开启公众号消息路由，将信息同步到自已的服务器后自行处理。

* 创建时可设置为用户默认关注，不需要用户主动关注公众号即可收到公众号推送的消息，设置后不能修改。

* 应用公众号不区开发、生产环境，应用通过创建的公众号 ID 进行接入。


### 应用公众 API 功能

* 消息接收
* 用户关注、取消关注事件推送
* 消息回复
* 消息群发
* 素材管理

* 文档地址：http://www.rongcloud.cn/docs/public_service.html#app_public_service



## 应用集成

* 支持平台包括：Android、iOS、Web

* 移动端 IMKit SDK 对公众号功能界面进行了封装，开发者可直接调用，文档地址如下：
	* Android：http://www.rongcloud.cn/docs/android.html#base_function_public_service
	* iOS：http://www.rongcloud.cn/docs/ios.html#base_function_public_service


## Admin 管理平台

* 客服人员通过 `Admin 后台 -> 公众号审核` 中对公众服务号（MP）进行审核管理操作，主要功能如下：
	1. 审核新创建的公众服务号。
	2. 推送公众服务号，将公众号显示在应用开发者平台，公众号市场推送一栏中。
	3. 冻结功能，被冻结后公众号服务平台将无法登录，不能再进行公众号相关操作。


## 问题

1. Web 开发者文档缺少公众号相关功能文档，需要补充。
2. 开发者模式下，通过接口上传管理素材时，Server 端对素材内容进行存储后，POST 内容到公众号管理平台（PHP），管理平台也对内容进行存储。但平台对素材的修改、删除不会同步 Server。Server 端存储的素材内容实际用处需要待讨论。
3. `开发者平台 -> 公众服务平台` 中添加私有公众号所需的“公众号识别码”需要增加获取方式说明。
4. 公众号消息未支持敏感词过滤


## 功能需求

1. 公众服务号开发者模式下，接口功能不完整，如自定义菜单功能、数据统计相关接口
2. 客户端用户查看公众号推送历史实现方式。
3. 关注用户的黑名单功能
4. 公众号中回复用户发送的消息无法撤回。
5. 公众号 API 接口的调试工具。
6. 客户端菜单点击数据统计。
7. 粉丝管理中无法按应用查看关注的用户信息。
8. 不支持按单个图文消息统计阅读数。
9. 素材管理中，支持视频及 gif、webp 格式的图片文件
10. 批量关注公众号功能接口


