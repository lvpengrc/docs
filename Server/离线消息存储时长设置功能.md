## 离线消息存储时长设置功能

### 名词解释

离线消息：用户未登录状态下，有新的需要接收消息时，该消息在融云服务器先进行存储（默认存储 7 天），用户下次登录后，直接获取的消息。

### 使用场景

用户登录后，可以查看未登录期间的离线消息。

### 功能描述

离线消息存储时长的级别包括：应用级、用户级。移动端 SDK 从 2.8.19 版本开始支持此功能。

* 应用级：默认存储时长为 7 天，客户不能主动设置，需要提交工单申请。
* 用户级：允许用户通过 SDK 接口设置离线消息存储时间，时间范围为（1-7天）。如用户未设置，继续使用平台7天的默认值。时间设置后，离线消息会按照用户设置的时间存储。

** 设置规则： **

1. 应用、用户未设置情况下，默认离线消息存储时长为 7 开。
2. 用户设置的存储时长不能大于应用级别设置的存储时长。应用级别最长设置不超过 7 天。
3. 用户先设置存储时长后，应用更新了存储时长，且小于用户设置的存储时长，则以用户设置为准 。
4. 存储用户离线消息的时候，存储时长使用用户设置和应用设置小的存储时间。

** 生效时间： **

当天设置完成后，0 点生效，生效后新离线消息按新的存储时长保存，之前生产的离线消息没有影响。

当天设置多次，以最后一次设置的存储时长为准。

### 存在的问题

1. 广播消息保存到离线消息中，新用户注册后，也会拉取到离线消息中存储的广播消息。
	
	根据业务的不同某些广播消息，新用户是不需要接收的，如：针对所有在线用户的通知消息。

2. 设置后，不是即时生效，当天设置完成后，0 点生效。


** 需求： **
	
1. 支持广播消息按条设置离线消息存储时长。详细见 [T1005](http://pha.rongcloud.net/T1005)
	
2. 增加新注册用户是否接收离线消息配置，根据业务情况自行设置。


** 场景： **
	
1. 发送预热活动类广播消息时，活动有效期为 3 天，可设置该消息的离线存储时长为 3 天，3 天内新注册用户仍然可收到该条消息。
	
2. 如系统管理员对应用下用户发送通知类消息时，该消息为通知当前应用下所有用户使用，新注册用户不需要收到该条消息。
	
3. 对所有在线用户发送即时活动通知，如冲顶大会的答题通知消息，只需要在线用户收到。


### 其他离线消息需求

** 场景 **

如果当 A 用户在旧系统给 B 用户发送了一条消息，此时 B 用户不在线，那么数据会保存老系统之中， 当接入融云后，B 用户登录IM，此次读取的是融云接口的数据，这个时候是看不到之前用户 A 的历史消息的。

** 需求 **

提供平滑迁移时离线消息存储同步接口。
