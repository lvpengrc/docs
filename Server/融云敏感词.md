# 融云敏感词

## 功能介绍

融云提供消息敏感词过滤功能，包括：敏感词基础服务、敏感词高级服务及云净网敏感词过滤服务，如下：

** 敏感词基础服务： **最多可设置 50 个，不可调整上限。

过滤方式   |应用范围   |支持过滤消息类型   
:----------|:--------|:---------------
敏感词消息屏蔽  |单聊、群组、讨论组、聊天室、客服下行消息 |文本 
敏感词替换  |单聊、群组、讨论组、聊天室 |文本  

** 敏感词高级服务： **在 50 个敏感词基础上可调整上限，最多为 2000 个。

过滤方式   |应用范围   |支持过滤消息类型   
:----------|:--------|:---------------
敏感词消息屏蔽  |单聊、群组、讨论组、聊天室、客服下行消息 |文本、自定义消息
敏感词替换  |单聊、群组、讨论组、聊天室 |文本、自定义消息
指定范围敏感词（待开发）  |指定聊天室 |文本

注：敏感词高级服务需要部署专署服务后才能使用。

> “指定范围敏感词”功能是指设置指定聊天室的敏感词，设置后立即生效，该功能目前为待开发状态。

** 云净网敏感词过滤服务： **

支持文本、图片消息敏感词过滤功能，如需要设置的敏感词数量大于 2000 或需要对图片消息进行过滤，可开通云净网敏感词过滤功能。

## 过滤方式说明

1、屏蔽包含敏感词的消息（简称屏蔽消息）：含有此类敏感词的消息发送到融云服务器后将被吞掉，目标用户不会收到该条消息。

2、替换敏感词：含有此类敏感词的消息发送到融云服务器后，将消息中的敏感词替换成指定的内容进行发送，目标用户收到的是替换后的消息内容。

如一条消息中同时含有需要屏蔽的敏感词和需要替换的敏感词时，则屏蔽该条消息。

## 敏感词设置

融云敏感词可通过应用开发者后台或调用敏感词 Server API 两种方式进行设置。

敏感词，最长不超过 32 个字符，格式为汉字、数字、字母。

### 开发者后台

在 “IM 服务 -> 敏感词设置”中设置敏感词，包括：屏蔽敏感词、替换敏感词，设置后 2 小时内生效。

** 文本消息过滤设置 **

支持设置文本消息（RC:TxtMsg）敏感词：

![添加敏感词](img/sensitiveword_add.png)

** 自定义消息过滤设置 **

注：自定义消息过滤需要开通“敏感词高级服务”后才能设置自定义消息类型。

首先需要设置自定义消息标识，根据设置的消息标识及对应的键值，过滤指定键值下的消息内容，如下：

![自定义消息](img/object_name.png)

### Server API

通过 Server API 可以设置文本消息类型的屏蔽和替换敏感词，暂不支持自定义消息类型敏感词设置， Server API 提供功能：

* 添加敏感词
* 移除敏感词
* 批量移除敏感词
* 查询敏感词列表

文档地址：http://www.rongcloud.cn/docs/server.html#sensitiveword

## 过滤规则

** 过滤优先级如下： **

1. 首先过滤融云默认敏感词。
2. 过滤开发者在融云设置的屏蔽敏感词、替换敏感词。
3. 如果开通云净网，将消息同步到云净网，过滤设置的敏感词。

** 过滤规则如下： **

1、支持对中文简体、繁体自动智能过滤。

即：设置中文简体敏感词后，对应繁体敏感词也会自动识别过滤。

2、智能忽略出现在中文敏感词中间的特殊符号、空白符。

设置的中文敏感词中间含有特殊符号或空白符时，会智能忽略，并对消息进行过滤，如：设置敏感词“反动”，当出现“反@   #￥……&* 动”的聊天信息时，也会过滤。

3、英文、数字敏感词，支持全角、半角，大、小写自动匹配，对英文单词进行智能识别过滤功能。如：设置敏感词 “av”，当出现含有 “Java” 的聊天信息时，因为 “Java” 为英文单词，所以不会进行过滤。

4、Server API 发送的消息默认不走敏感词过滤，如需要过滤敏感词可提交申请；

注：Server API 发送消息的敏感词过滤目前只支持机器智能过滤方式，不支持云净网提供的人工审核过滤方式。

## 含有敏感词消息能否进行路由

如果开通了服务端实时消息路由功能，默认情况下含有敏感词消息的路由规则如下：

* 默认消息中包含需要屏蔽的敏感词时，不会同步到应用服务器。

* 如果含有替换敏感词时，会将消息中的敏感词替换成指定的内容进行发送，同时同步到应用服务器。

> 如需要将含有敏感词的所有消息同步到应用服务器，可提交工单申请开通“含敏感词消息路由功能”，同步的消息中是否含有敏感词的状态说明请查看[服务端实时消息路由接入文档](http://www.rongcloud.cn/docs/server.html#message_sync)。

## 单群聊（聊天室）历史消息云存储

开通云存储功能后，含有屏蔽敏感词的消息融云服务端不会存储，含有替换敏感词的消息将进行存储，存储为替换后的消息。

## 使用云净网过滤消息

### 功能说明

1. 目前支持审核的消息类型包括：文本消息、图片消息。会话类型包括：单聊、群聊、聊天室。

2. 审核方式支持人工审核和自动审核，人工审核需要联系云净网在云净网管理平台审核。

3. 消息发送给云净网后，根据返回结果审核通过的正常下发，审核不通过的消息将被屏蔽。人工审核状态下，默认3个小时内没有结果返回时，按审核不通过处理。（时间可进行配置）

4. 消息路由功能，审核通过的消息正常路由该消息，审核不通过的消息不进行路由。如客户开通了含敏感词消息路由功能后，含有敏感词的消息也进行路由。

5. 属于公有云功能，需要申请开通后才能使用。

> 注：消息在人工审核时，如果对该条消息进行了撤回操作，人工未审核完成时，消息撤回不成功，所以功能在人工审核情况下与消息撤回功能不能同时使用。

### 开通流程

1. 首先提交客户信息（邮箱、生产AppKey、测试AppKey、需要审核的需求范围），提交到云净网配置审核内容，云净网返回客户审核范围的 AppID。

	因为审核规则不同，所以每个 AppID 对应一个审核范围，例如：
	
	* 单聊中的文本消息审核，云净网侧需要提供一个 AppID
	
	* 单聊中的图片消息审核，云净网侧也需要提供一个 AppID
	
	* 群组、聊天室，也是一样的。

目前由融云（王珊珊）提交客户信息。注意在开通功能前需要明确用户审核需求。

2、云净网完成配置后，将审核范围及对应云净网返回的 AppID，提供给 Server 端，由陈朗完成 Server 端配置，配置完成后 2 小时内生效，可正常使用。


## 对接第三方敏感词过滤系统

在提供敏感词过滤的基础上，融云也支持对接第三方敏感词过滤系统。

** 实现流程： **

1. 第三方需要提供敏感词过滤接口。
2. 确定客户业务中需要过滤的会话及消息类型。
3. 融云 Server 端完成消息对接配置工作。
4. 客户与融云 Server 进行联调。

> 描述：融云通过 HTTP 将消息 POST 到第三方接口地址，用户在收到消息过滤完成后需要给出响应，融云根据响应结果进行发送或者屏蔽处理。目前只支持机器自动审核。

推荐客户优先使用融云敏感词及云净网过滤方式，不建议使用第三方敏感词过滤，将影响消息收发效率。


